<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>transmotion.configs - TransMotion documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">TransMotion  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">TransMotion  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Stages of Motion Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../train_signal.html">Training Signals</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">transmotion</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../transmotion.html">transmotion package</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for transmotion.configs</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Sequence</span>


<div class="viewcode-block" id="TPSConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.TPSConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TPSConfig</span><span class="p">:</span>
    <span class="n">num_tps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; We use multiple TPS transforms. Here you specify the number to use&quot;&quot;&quot;</span>
    <span class="n">points_per_tps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; Each TPS transform has a number of control points that will be matched exactly. Here you specify the number of those points &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DenseMotionConf"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.DenseMotionConf">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DenseMotionConf</span><span class="p">:</span>

    <span class="n">base_dim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; Dimension that encoder and decoder networks start from. This dim multiplied in each block i by a factor of :math:`2^i` &quot;&quot;&quot;</span>
    <span class="n">tps</span><span class="p">:</span> <span class="n">TPSConfig</span>
    <span class="n">num_blocks</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; Input dimension to the dense motion network. Usually the input is an image so this value is 3 &quot;&quot;&quot;</span>
    <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">kp_variance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="sd">&quot;&quot;&quot; Variance used in Gaussian heatmaps representation  &quot;&quot;&quot;</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">num_occlusion_masks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="InpaintingConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.InpaintingConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">InpaintingConfig</span><span class="p">:</span>
    <span class="n">base_dim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_down_blocks</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_occlusion_masks</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_occlusion_masks_consistent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_occlusion_masks_consistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Occlusion masks must be one more than down blocks (or a single mask) got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_occlusion_masks</span><span class="si">}</span><span class="s2"> massk and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_down_blocks</span><span class="si">}</span><span class="s2"> blocks&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_occlusion_masks</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_down_blocks</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_occlusion_masks</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_msg</span></div>


<div class="viewcode-block" id="PerceptualLoss"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.PerceptualLoss">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PerceptualLoss</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get VGG features from multiple scales of the driving image and the generated image.</span>
<span class="sd">    Train on generated images with :math:`L_1` loss.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scales</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; List of float number that represent the scaling factors to be applied on the images. This needs to conform to the number of feature maps you get from the perceptual loss network.</span>
<span class="sd">    By default we use VGG19 here, this net has 5 feature map output. #TODO: Might need to make this more general and explicitly link number of feature maps to number of scales.&quot;&quot;&quot;</span>
    <span class="n">loss_weights</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; Loss weights (for each scale) when aggreagted into total loss value &quot;&quot;&quot;</span>
    <span class="n">in_dim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; Perceptual loss multi-scale image pyramid, this is the in dimension of the pyramid input &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="EquivarianceLoss"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.EquivarianceLoss">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">EquivarianceLoss</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; This loss requires a random TPS transformation, the parameters of this transformation are specified here.&quot;&quot;&quot;</span>

    <span class="n">sigma_tps</span><span class="p">:</span> <span class="nb">float</span>
    <span class="sd">&quot;&quot;&quot; standard deviation for TPS kernel mixing params (generated randomly) &quot;&quot;&quot;</span>
    <span class="n">sigma_affine</span><span class="p">:</span> <span class="nb">float</span>
    <span class="sd">&quot;&quot;&quot; standard deviation for affine transform params (generated randomly) &quot;&quot;&quot;</span>
    <span class="n">points_per_tps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; number of control points to use for the TPS &quot;&quot;&quot;</span>
    <span class="n">loss_weight</span><span class="p">:</span> <span class="nb">float</span></div>


<div class="viewcode-block" id="WarpLoss"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.WarpLoss">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">WarpLoss</span><span class="p">:</span>
    <span class="n">loss_weight</span><span class="p">:</span> <span class="nb">float</span></div>


<div class="viewcode-block" id="BackgroundLoss"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.BackgroundLoss">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BackgroundLoss</span><span class="p">:</span>
    <span class="n">loss_weight</span><span class="p">:</span> <span class="nb">float</span></div>


<div class="viewcode-block" id="LossConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.LossConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LossConfig</span><span class="p">:</span>
    <span class="n">perceptual</span><span class="p">:</span> <span class="n">PerceptualLoss</span>
    <span class="n">equivariance</span><span class="p">:</span> <span class="n">EquivarianceLoss</span>
    <span class="n">warp</span><span class="p">:</span> <span class="n">WarpLoss</span>
    <span class="n">background</span><span class="p">:</span> <span class="n">BackgroundLoss</span></div>


<div class="viewcode-block" id="OptimizerConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.OptimizerConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OptimizerConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Learning rates, decay parameters and scheduling</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_lr</span><span class="p">:</span> <span class="nb">float</span>
    <span class="sd">&quot;&quot;&quot; base learning rate for the optimizer &quot;&quot;&quot;</span>
    <span class="n">lr_decay_epoch_sched</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot; Sequence of epoch numbers that represent learning rate decay steps. decay is by lr_decay_gamma &quot;&quot;&quot;</span>

    <span class="n">lr_decay_gamma</span><span class="p">:</span> <span class="nb">float</span>
    <span class="sd">&quot;&quot;&quot; Learning rate decay parameter. Decay happens according to lr_decay_epoch_sched &quot;&quot;&quot;</span>
    <span class="n">adam_beta1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">adam_beta2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.999</span>
    <span class="n">weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span></div>


<div class="viewcode-block" id="DropoutConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.DropoutConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DropoutConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop-out is applied during training to the DenseMotion network. Its not a property of the network but an external param to the forward pass.</span>
<span class="sd">    So the config for that is in general train config and not the dense motion config.</span>

<span class="sd">    :param prob_inc_epoch: Increment dropout probability over this amount of epochs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start_epoch</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">init_prob</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_prob</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">prob_inc_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="DataLoadingConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.DataLoadingConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DataLoadingConfig</span><span class="p">:</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="TrainConfig"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.TrainConfig">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TrainConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Specifies all the parameters needed for training &quot;&quot;&quot;</span>

    <span class="n">data_loading</span><span class="p">:</span> <span class="n">DataLoadingConfig</span>
    <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">optimizer</span><span class="p">:</span> <span class="n">OptimizerConfig</span>
    <span class="n">dropout</span><span class="p">:</span> <span class="n">DropoutConfig</span>
    <span class="n">dense_motion</span><span class="p">:</span> <span class="n">DenseMotionConf</span>
    <span class="n">inpainting</span><span class="p">:</span> <span class="n">InpaintingConfig</span>
    <span class="n">tps</span><span class="p">:</span> <span class="n">TPSConfig</span>
    <span class="n">loss</span><span class="p">:</span> <span class="n">LossConfig</span>
    <span class="n">background_start_epoch</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; You might want to start background training later, this specifies what epoch bg training will start&quot;&quot;&quot;</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="sd">&quot;&quot;&quot; TPS works on square images of size ``image_size x image_size``&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="dummy_conf"><a class="viewcode-back" href="../../transmotion.html#transmotion.configs.dummy_conf">[docs]</a><span class="k">def</span> <span class="nf">dummy_conf</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TrainConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;VOX model dummy config&quot;&quot;&quot;</span>
    <span class="n">dl_conf</span> <span class="o">=</span> <span class="n">DataLoadingConfig</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">opt_conf</span> <span class="o">=</span> <span class="n">OptimizerConfig</span><span class="p">(</span>
        <span class="n">initial_lr</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">lr_decay_epoch_sched</span><span class="o">=</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="n">lr_decay_gamma</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>
    <span class="n">do_conf</span> <span class="o">=</span> <span class="n">DropoutConfig</span><span class="p">(</span>
        <span class="n">start_epoch</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">init_prob</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_prob</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">prob_inc_epochs</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="n">tps_conf</span> <span class="o">=</span> <span class="n">TPSConfig</span><span class="p">(</span><span class="n">num_tps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">points_per_tps</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dense_conf</span> <span class="o">=</span> <span class="n">DenseMotionConf</span><span class="p">(</span>
        <span class="n">base_dim</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">tps</span><span class="o">=</span><span class="n">tps_conf</span><span class="p">,</span> <span class="n">num_blocks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">in_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">1024</span>
    <span class="p">)</span>

    <span class="n">inpaint_conf</span> <span class="o">=</span> <span class="n">InpaintingConfig</span><span class="p">(</span>
        <span class="n">base_dim</span><span class="o">=</span><span class="n">dense_conf</span><span class="o">.</span><span class="n">base_dim</span><span class="p">,</span>
        <span class="n">in_features</span><span class="o">=</span><span class="n">dense_conf</span><span class="o">.</span><span class="n">in_features</span><span class="p">,</span>
        <span class="n">num_down_blocks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">num_occlusion_masks</span><span class="o">=</span><span class="n">dense_conf</span><span class="o">.</span><span class="n">num_occlusion_masks</span><span class="p">,</span>
        <span class="n">max_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">loss_conf</span> <span class="o">=</span> <span class="n">LossConfig</span><span class="p">(</span>
        <span class="n">perceptual</span><span class="o">=</span><span class="n">PerceptualLoss</span><span class="p">(</span>
            <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">],</span> <span class="n">loss_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">in_dim</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">),</span>
        <span class="n">equivariance</span><span class="o">=</span><span class="n">EquivarianceLoss</span><span class="p">(</span>
            <span class="n">sigma_tps</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
            <span class="n">sigma_affine</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">points_per_tps</span><span class="o">=</span><span class="n">tps_conf</span><span class="o">.</span><span class="n">points_per_tps</span><span class="p">,</span>
            <span class="n">loss_weight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">warp</span><span class="o">=</span><span class="n">WarpLoss</span><span class="p">(</span><span class="n">loss_weight</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">background</span><span class="o">=</span><span class="n">BackgroundLoss</span><span class="p">(</span><span class="n">loss_weight</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">TrainConfig</span><span class="p">(</span>
        <span class="n">data_loading</span><span class="o">=</span><span class="n">dl_conf</span><span class="p">,</span>
        <span class="n">num_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">opt_conf</span><span class="p">,</span>
        <span class="n">dropout</span><span class="o">=</span><span class="n">do_conf</span><span class="p">,</span>
        <span class="n">dense_motion</span><span class="o">=</span><span class="n">dense_conf</span><span class="p">,</span>
        <span class="n">inpainting</span><span class="o">=</span><span class="n">inpaint_conf</span><span class="p">,</span>
        <span class="n">tps</span><span class="o">=</span><span class="n">tps_conf</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="n">loss_conf</span><span class="p">,</span>
        <span class="n">background_start_epoch</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">image_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="p">)</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Gregory Axler
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>