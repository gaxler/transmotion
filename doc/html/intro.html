<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Training Signals" href="train_signal.html" /><link rel="prev" title="Welcome to TransMotion’s documentation!" href="index.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>Stages of Motion Transfer - TransMotion documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">TransMotion  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">TransMotion  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Stages of Motion Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_signal.html">Training Signals</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">transmotion</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="transmotion.html">transmotion package</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="stages-of-motion-transfer">
<h1>Stages of Motion Transfer<a class="headerlink" href="#stages-of-motion-transfer" title="Permalink to this headline">#</a></h1>
<p>Motion Transfer Models take a still image and a video and animate the
still image such that it mimics the motion of the video. We refer to the
still image as the <strong>source</strong> and to the video as <strong>driving</strong>.</p>
<p>Our particular model is <a class="reference external" href="https://arxiv.org/abs/2203.14367">Thin-Plate Spline motion transfer</a> <a class="footnote-reference brackets" href="#id3" id="id1">0</a>.
It has three major stage:</p>
<ol class="arabic simple">
<li><p><strong>Detect Key-points</strong> - Use a ResNet model to discover points of
interest in an image. We do this for the source image and for the
driving video.</p></li>
<li><p><strong>Turn Key-points to optical flow</strong> - Based on the difference between
source and driving key-points we infer an optical flow <a class="footnote-reference brackets" href="#id4" id="id2">1</a>. Some
parts of the driving image can’t be seen in the source image, so if
we also try and infer where those areas are (we call those occluded
areas)</p></li>
<li><p><strong>Fill-in the occluded areas</strong> - A generative model is use to predict
what should go in the missing parts.</p></li>
</ol>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">0</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/yoyo-nb/Thin-Plate-Spline-Motion-Model">original repository</a></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>where each pixel from the source image should move if we want to
deform it to match the driving image</p>
</dd>
</dl>
<section id="detect-key-points">
<h2>Detect Key-points<a class="headerlink" href="#detect-key-points" title="Permalink to this headline">#</a></h2>
<p>We use a <code class="docutils literal notranslate"><span class="pre">ResNet18</span></code> model to predict the key-points. Key-points
are just 2D coordinates on an image. So the ResNet outputs a vector with
a dimension of <span class="math notranslate nohighlight">\(K \times N \times 2\)</span> and values <span class="math notranslate nohighlight">\(\in [0,1]\)</span>. <a class="reference internal" href="transmotion.html#transmotion.kp_detection.KPDetector" title="transmotion.kp_detection.KPDetector"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.kp_detection.KPDetector</span></code></a> is the key-points detector network and <a class="reference internal" href="transmotion.html#transmotion.kp_detection.KPResult" title="transmotion.kp_detection.KPResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.kp_detection.KPResult</span></code></a> bundles the outputs</p>
<section id="what-are-those-k-and-n-over-there">
<h3>What are those <span class="math notranslate nohighlight">\(K\)</span> and <span class="math notranslate nohighlight">\(N\)</span> over there??<a class="headerlink" href="#what-are-those-k-and-n-over-there" title="Permalink to this headline">#</a></h3>
<p>The model uses multiple deformations (later on that) in this case <span class="math notranslate nohighlight">\(K\)</span> is the number of deformation and <span class="math notranslate nohighlight">\(N\)</span> is the number of points per deformation.</p>
</section>
</section>
<section id="turn-key-points-to-optical-flow">
<h2>Turn Key-points to optical flow<a class="headerlink" href="#turn-key-points-to-optical-flow" title="Permalink to this headline">#</a></h2>
<p>Key-points are sparse and lossy representation of what’s going on in the
images. We need to use this information to actually estimate how to
deform the image to do that we do several things:</p>
<ol class="arabic simple">
<li><p><strong>Heatmap Representation</strong>: Turn sparse key-points into a Gaussian
heatmap</p></li>
<li><p><strong>Estimate Image Deformation</strong>: Key-points represent sparse motion,
that is we only know where limited number of points in the source
image should move to. To estimate what happens to the other points in
the image we learn a Thin-Plate Spline Transformation (TPS).</p></li>
<li><p><strong>Occlusion Masks</strong>: Image deformation is too simple for the real
world (e.g. some parts of the driving image can’t be seen on the
source image). We estimate what we don’t know after applying
deformation.</p></li>
</ol>
<p>All this happens inside <a class="reference internal" href="transmotion.html#transmotion.dense_motion.DenseMotionNetwork" title="transmotion.dense_motion.DenseMotionNetwork"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.dense_motion.DenseMotionNetwork</span></code></a> and the output is bundled in <a class="reference internal" href="transmotion.html#transmotion.dense_motion.DenseMotionResult" title="transmotion.dense_motion.DenseMotionResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.dense_motion.DenseMotionResult</span></code></a></p>
<section id="tps">
<h3>TPS<a class="headerlink" href="#tps" title="Permalink to this headline">#</a></h3>
<p>From a birds eye view, TPS takes a 2D points as input and produces 2D
point as an output. The idea is to make the TPS tell us where points
from the source image should move to match the driving frame. The only
known points for us are the key-points we found earlier. We call those
the control points of the TPS.</p>
<p>TPSs output for the control points on the driving frame will match the
control points on the source frame. Other points will be smoothly moved
based on the movement of the control points (weighted by the distance
from current points to the control points).</p>
<p>The different colors in &#64;fig-key-points-demo represent control points
for different TPS transforms. Here we will use a bunch of the to deform
the image in many different ways. The different TPS transforms are mixed
together using weighting coefficients learned by a neural-net</p>
</section>
<section id="why-do-we-need-occlusion-masks">
<h3>Why do we need occlusion masks?<a class="headerlink" href="#why-do-we-need-occlusion-masks" title="Permalink to this headline">#</a></h3>
<p>TPS is a simple transformation compared to the complexity that is
required to transform a pose of a person in a real image. Also, TPS is
locally accurate, that is only fits the key-points we asked it to fit.</p>
<p>Going outside further from those points we lose accuracy completely. We
need to know what are the region we can’t approximate well with a simple
image deformation. This can be because a new feature needs to appear
(e.g. person shows no teeth in the static image, but needs to show those
as part of motion transfer) or because our approximation is bad.</p>
</section>
</section>
<section id="fill-in-the-occluded-areas">
<h2>Fill-in the occluded areas<a class="headerlink" href="#fill-in-the-occluded-areas" title="Permalink to this headline">#</a></h2>
<p>At this point we have the optical flow and the occlusion masks, now its
time to inpaint the missing areas from the image. The inpainting is done
by an encoder-decoder architecture. We encode the source image and
decode back the transformed source image. All this happens in <a class="reference internal" href="transmotion.html#transmotion.inpainting.InpaintingNetwork" title="transmotion.inpainting.InpaintingNetwork"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.inpainting.InpaintingNetwork</span></code></a> and the final results are bundled in <a class="reference internal" href="transmotion.html#transmotion.inpainting.InpaintingResult" title="transmotion.inpainting.InpaintingResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">transmotion.inpainting.InpaintingResult</span></code></a></p>
<p>The encoding is a series of feature maps on the decoding end, the
feature maps get deformed by the optical flow and occluded by the
occlusion masks and passed through a decoder layer. So what the
encoder-decoder predicts is the occluded areas. At the end of the
decoder we take a deformed source image, occlude it and add the
predicted occluded areas.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="train_signal.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Training Signals</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Gregory Axler
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Stages of Motion Transfer</a><ul>
<li><a class="reference internal" href="#detect-key-points">Detect Key-points</a><ul>
<li><a class="reference internal" href="#what-are-those-k-and-n-over-there">What are those <span class="math notranslate nohighlight">\(K\)</span> and <span class="math notranslate nohighlight">\(N\)</span> over there??</a></li>
</ul>
</li>
<li><a class="reference internal" href="#turn-key-points-to-optical-flow">Turn Key-points to optical flow</a><ul>
<li><a class="reference internal" href="#tps">TPS</a></li>
<li><a class="reference internal" href="#why-do-we-need-occlusion-masks">Why do we need occlusion masks?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fill-in-the-occluded-areas">Fill-in the occluded areas</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>